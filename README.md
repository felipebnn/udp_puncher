# UDP Puncher
A python script that punches a UDP port and opens a Wireguard VPN on it to keep it open. For hosts behind a NAT this allows for TCP/UDP communication between two hosts without any portforwarding. It uses a STUN server that swaps hosts information around. This STUN server needs to be visible from the internet either with a public ip or port forwarding.

There are example config files for the STUN server, host A and host B in their respective folders.

# Running the script
- Configure the ip and port of the STUN server on the hosts config files as well as on the STUN server config file.
- Start `server.py` on the STUN server machine.
- Run `puncher.py host_config.json` on one of the hosts. This will open a room called `'test_room'` with password `'room_password'`.
- Run `puncher.py partner_config.json` on the other host. This will join the already existing room `'test_room'` and start the punch process.

After the punch is finished, a wireguard config file will be generated based on the config file name used and wireguard will be setup with this config file automatically.

To stop the wireguard VPN, simply press Enter on both hosts.

If the host script is run without any arguments, the script will try to use a file called `config.json`.

# Example Config Files
- It is advised that you change the private and public keys used in this example as well as the `security_key` and room information as they are all publicly available here on this repo.

# Host Config File
```json
{
	"stun_server": "IP of the STUN server",
	"stun_udp_port": "port of the matchmaking script running on the STUN server",
	"security_key": "server password, used on all packets sent",
	"private_key": "peer private key generated by wireguard",
	"user_data": {
		"command": "can be either open or join. this will open or join a room in the matchmaking server",
		"room_name": "room name",
		"password": "room password",
		"public_key": "peer public key generated by wireguard",
		"subnet": "subnet to be used by both peers, the last byte from the ip should be an @ which will be replaced by either 1 or 2 for each peer eg: 10.100.100.@/24"
	},
	"wireguard_exe": "wireguard.exe path so the script can initialize or finalize the vpn"
}
```

# Server Config File
```json
{
    "port": "port of the matchmaking script",
    "security_key": "server password, used on all packets received by the hosts"
}
```

# For Linux
It is possible to use this script to open a vpn between windows and linux hosts. Currently it does not work out of the box. The line `self.start_wireguard()` needs to be removed, and the VPN should be started manually with a command similar to:
```bash
./puncher.py && sudo wg-quick up config_wg
```
To stop the wireguard VPN, you can run a command similar to:
```bash
sudo wg-quick down config_wg
```
